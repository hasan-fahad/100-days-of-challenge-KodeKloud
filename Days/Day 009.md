# Day 009 **Debugging MariaDB Issues**

There is a critical issue going on with the **Nautilus application** in **Stratos DC**. The production support team identified that the application is unable to connect to the database. After investigation, they found that the **MariaDB service is down** on the database server. Your task is to diagnose and fix the issue.

---

## ‚úÖ **Steps to Resolve the Issue**

We need to check the following possible problem areas:

* File permissions
* Socket file issues
* Data directory mismatches
* Incorrect configuration values

---

## **1. Login into the Database Server**

```bash
ssh peter@stdb01
sudo -i
```

---

## **2. Check MariaDB Logs**

```bash
tail -f /var/log/mariadb.log
```

**Sample Output:**

```
2025-08-03  8:54:14 0 [Note] /usr/libexec/mariadbd (initiated by: unknown): Normal shutdown
2025-08-03  8:54:14 0 [Note] Event Scheduler: Purging the queue. 0 events
2025-08-03  8:54:14 0 [Note] InnoDB: Starting shutdown...
2025-08-03  8:54:14 0 [Note] InnoDB: Dumping buffer pool(s)
2025-08-03  8:54:14 0 [Note] /usr/libexec/mariadbd: Shutdown complete
```

The log shows a **normal shutdown**, not a crash ‚Äî meaning MariaDB failed to start afterward.

---

## **3. Check MariaDB Service Status**

```bash
systemctl status mariadb
```

**Output:**

```
‚óã mariadb.service - MariaDB 10.5 database server
Active: inactive (dead)
Status: "MariaDB server is down"
```

---

## **4. Try Restarting MariaDB**

```bash
sudo systemctl enable mariadb
sudo systemctl start mariadb
```

If it fails, the problem is likely **configuration or datadir mismatch**.

---

## **5. Inspect Config Files**

```bash
cat /etc/my.cnf.d/mariadb-server.cnf
```

### ‚ö†Ô∏è Problem Found:

* Configured datadir: **/var/lib/mysql/**
* Actual data location: **/var/lib/mysqld/**

MariaDB cannot start if **datadir path does not match**.

---

## **6. Fix Datadir Mismatch**

### **1Ô∏è‚É£ Create Correct Data Directory**

```bash
mkdir /var/lib/mysqld
```

### **2Ô∏è‚É£ Copy Existing Database Files**

```bash
cp -rp /var/lib/mysql/* /var/lib/mysqld/
```

### **3Ô∏è‚É£ Fix Permissions**

```bash
chown -R mysql:mysql /var/lib/mysqld
chmod 750 /var/lib/mysqld
```

---

## **7. Restart MariaDB**

```bash
sudo systemctl restart mariadb
```

Check status:

```bash
systemctl status mariadb
```

If it shows **active (running)**, the issue is resolved.

---

# üìò **MariaDB Troubleshooting Reference**

### **Log Locations**

* `/var/log/mariadb/mariadb.log`
* `/var/log/mysqld.log`

### **Config Locations**

* `/etc/my.cnf`
* `/etc/my.cnf.d/`

### **Default Paths**

* **Data Directory:** `/var/lib/mysql/`
* **Socket File:** `/var/lib/mysql/mysql.sock`
* **Port:** `3306`

---

## üîß **Common Issues & Fixes**

### **1. Permission Problems**

* Ensure datadir ownership:

```bash
chown -R mysql:mysql /var/lib/mysql
```

### **2. Config Errors**

* Validate `.cnf` syntax before restart.
* Incorrect datadir causes failures.

### **3. Disk Space**

```bash
df -h
```

### **4. Port Already in Use**

```bash
ss -tunlp | grep 3306
```

---

## üõ†Ô∏è **Useful Diagnostic Commands**

* Check service:

```bash
systemctl status mariadb
```

* View detailed system logs:

```bash
journalctl -u mariadb
```

* Test DB connectivity:

```bash
mysqladmin ping
```

* Login:

```bash
mysql -u root -p
```

---

## üîê **File & Directory Permissions**

* **Data Directory:** `mysql:mysql`, `750`
* **Config Files:** `root:root`, `644`
* **Socket File:** `mysql:mysql`
* **Log Files:** `mysql:mysql`

---

If you want, I can add:
‚úÖ A troubleshooting flowchart
‚úÖ A diagram of MariaDB architecture
‚úÖ Commands to fully rebuild corrupt tables

Just tell me!
