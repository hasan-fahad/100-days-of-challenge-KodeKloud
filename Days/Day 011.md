# Day 011: Install and Setup Tomcat Server

The **Nautilus** development team has prepared a Java-based application for deployment. The task is to install and configure **Tomcat Server** on App Server 1 and deploy the ROOT.war application.

---

## üéØ Objective

* Install Tomcat server
* Configure Tomcat to run on port 5004
* Deploy `ROOT.war` from jump host
* Ensure application accessible at `http://stapp01:5004`

---

## üîß Steps

### 1Ô∏è‚É£ Install JVM

```bash
sudo yum install java-1.8.0-openjdk-devel -y
```

### 2Ô∏è‚É£ Create Tomcat User

```bash
sudo groupadd tomcat
sudo useradd -M -U -d /opt/tomcat -s /bin/nologin -g tomcat tomcat
```

### 3Ô∏è‚É£ Create Tomcat Directory

```bash
sudo mkdir /opt/tomcat
```

### 4Ô∏è‚É£ Download & Extract Tomcat

```bash
wget https://archive.apache.org/dist/tomcat/tomcat-9/v9.0.80/bin/apache-tomcat-9.0.80.tar.gz
sudo tar -xf apache-tomcat-9.0.80.tar.gz -C /opt/tomcat --strip-components=1
```

### 5Ô∏è‚É£ Set Permissions

```bash
sudo chown -R tomcat:tomcat /opt/tomcat
```

### 6Ô∏è‚É£ Create systemd Service

Create `/etc/systemd/system/tomcat.service`:

```
[Unit]
Description=Apache Tomcat Web Application Container
After=network.target

[Service]
Type=forking
User=tomcat
Group=tomcat
Environment="JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.362.b09-4.el9.x86_64"
Environment="CATALINA_PID=/opt/tomcat/temp/tomcat.pid"
Environment="CATALINA_HOME=/opt/tomcat"
Environment="CATALINA_BASE=/opt/tomcat"
ExecStart=/opt/tomcat/bin/startup.sh
ExecStop=/opt/tomcat/bin/shutdown.sh
RestartSec=10
Restart=always

[Install]
WantedBy=multi-user.target
```

### 7Ô∏è‚É£ Start Tomcat Service

```bash
sudo systemctl daemon-reload
sudo systemctl enable tomcat
sudo systemctl start tomcat
```

### 8Ô∏è‚É£ Test Default Access

```bash
curl http://stapp01:8080
```

### 9Ô∏è‚É£ Modify Port

Edit `/opt/tomcat/conf/server.xml` and change port 8080 to 5004:

```xml
<Connector port="5004" protocol="HTTP/1.1" connectionTimeout="20000" redirectPort="8443" maxParameterCount="1000"/>
```

### üîü Backup Old ROOT Application

```bash
cd /opt/tomcat/webapps
mv ROOT ROOT.bak
```

### 1Ô∏è‚É£1Ô∏è‚É£ Copy ROOT.war from Jump Host

```bash
scp /tmp/ROOT.war tony@stapp01:/home/tony/
```

### 1Ô∏è‚É£2Ô∏è‚É£ Unzip ROOT.war

```bash
sudo unzip /home/tony/ROOT.war -d /opt/tomcat/webapps/ROOT
```

### 1Ô∏è‚É£3Ô∏è‚É£ Restart Tomcat

```bash
sudo systemctl restart tomcat
```

### 1Ô∏è‚É£4Ô∏è‚É£ Test Application

```bash
curl http://stapp01:5004
```

Expected Output:

```html
<h2>Welcome to xFusionCorp Industries!</h2>
```

---

## üìò Good to Know

### Apache Tomcat Fundamentals

* Java servlet container
* Default ports: 8080 (HTTP), 8443 (HTTPS), 8005 (Shutdown)
* Directory structure: `/bin`, `/conf`, `/webapps`

### Java Application Deployment

* WAR files contain web apps
* ROOT.war is served at context `/`
* Hot deployment possible without stopping server

### Tomcat Configuration Files

* `server.xml`: main server configuration
* `web.xml`: web application descriptor
* `tomcat-users.xml`: authentication users
* `catalina.properties`: system properties

### Security Best Practices

* Run Tomcat as non-root user
* Restrict configuration file permissions
* Secure or remove Manager app
* Enable SSL/TLS for prod
