# Day 12 â€“ Linux Network Services ğŸ§ğŸŒ

## ğŸ“Œ Problem Overview

Our monitoring system reported that **Apache service is not reachable on port `8085`** on one of the app servers (`stapp01`) in the **Stratos Datacenter**.

Possible causes included:

* Apache service down
* Port conflict
* Firewall restrictions
* Network connectivity issues

The goal was to **identify the root cause, fix it securely**, and ensure Apache is reachable from the **jump host** using:

```bash
curl http://stapp01:8085
```

---

## ğŸ› ï¸ Environment

* **Server**: `stapp01`
* **Service**: Apache (`httpd`)
* **Expected Port**: `8085`
* **Access Test**: Jump host â†’ App server

---

## ğŸ” Step-by-Step Troubleshooting

### 1ï¸âƒ£ Login to App Server

```bash
ssh tony@stapp01
```

---

### 2ï¸âƒ£ Check Apache Service Status

```bash
sudo systemctl status httpd
```

**Observed Error:**

```
(98)Address already in use: AH00072: make_sock: could not bind to address 0.0.0.0:8085
```

ğŸ‘‰ This indicates a **port conflict**.

---

### 3ï¸âƒ£ Identify Which Service Is Using Port 8085

```bash
sudo netstat -tlnup
```

**Result:**

```
127.0.0.1:8085 LISTEN 430/sendmail
```

âœ… `sendmail` was already listening on port **8085**.

---

## ğŸ”„ Port Conflict Resolution

### 4ï¸âƒ£ Decision

Since Apache **must run on port 8085**, we changed the **sendmail port** instead of Apache.

---

### 5ï¸âƒ£ Change Sendmail Port

```bash
cd /etc/mail
cp sendmail.mc sendmail.mc.bak
vi sendmail.mc
```

Modify the following line:

```bash
DAEMON_OPTIONS(`Port=8085,Addr=127.0.0.1, Name=MTA')dnl
```

â¡ï¸ Change to:

```bash
DAEMON_OPTIONS(`Port=1234,Addr=127.0.0.1, Name=MTA')dnl
```

Restart sendmail:

```bash
sudo systemctl restart sendmail
```

---

### 6ï¸âƒ£ Verify Services & Ports

```bash
sudo netstat -tlnup
sudo systemctl status httpd sendmail
```

Now Apache can bind to **8085 successfully** ğŸ‰

---

## ğŸ” Firewall Troubleshooting

### 7ï¸âƒ£ Test Locally

```bash
curl http://localhost:8085
```

âœ”ï¸ Works locally

---

### 8ï¸âƒ£ Test From Jump Host

```bash
curl http://stapp01:8085
```

âŒ Connection failed â†’ Firewall suspected

---

### 9ï¸âƒ£ Check Firewall Rules

```bash
sudo iptables -L -n
```

**Issue Identified:**

* Only SSH (22) was allowed
* Other ports were blocked by default

---

### ğŸ”“ Allow Apache Port 8085

```bash
sudo iptables -I INPUT 4 -p tcp --dport 8085 -j ACCEPT
```

---

## âœ… Final Verification

From **Jump Host**:

```bash
curl http://stapp01:8085
```

ğŸ¯ **Apache is now reachable successfully!**

---

## ğŸ“š Useful Commands & Tools

### Network Troubleshooting

* `netstat -tlnup` â€“ List listening ports
* `ss -tlnup` â€“ Faster alternative to netstat
* `telnet host port` â€“ Test TCP connectivity
* `lsof -i :PORT` â€“ Find process using a port

### Firewall

* `iptables -L -n` â€“ View firewall rules
* Rule order matters (top â†’ bottom)

### Services

* `systemctl status service`
* `journalctl -u service`

---

## ğŸ§  Key Takeaways

* Always check **port conflicts** when services fail to start
* Use **netstat/ss + lsof** for quick diagnosis
* Firewall rules can silently block services
* Fix issues without compromising security

---
